/*! Cofoundry 2020-06-22 */
angular.module("cms.documents",["ngRoute","cms.shared"]).constant("_",window._).constant("documents.modulePath","/Admin/Modules/Documents/Js/"),angular.module("cms.documents").config(["$routeProvider","shared.routingUtilities","documents.modulePath",function(a,b,c){b.registerCrudRoutes(a,c,"Document")}]),angular.module("cms.documents").factory("documents.documentService",["$http","shared.documentService",function(a,b){var c=_.extend({},b);return c.update=function(a){return c.uploadFile(c.getIdRoute(a.documentAssetId),a,"PUT")},c.remove=function(b){return a["delete"](c.getIdRoute(b))},c}]),angular.module("cms.documents").controller("AddDocumentController",["$location","_","shared.focusService","shared.stringUtilities","shared.LoadState","documents.documentService",function(a,b,c,d,e,f){function g(){j(),m.save=h,m.cancel=k,m.onFileChanged=i,m.editMode=!1,m.saveLoadState=new e}function h(){m.saveLoadState.on(),f.add(m.command).progress(m.saveLoadState.setProgress).then(l)["finally"](m.saveLoadState.off)}function i(){var a=m.command;a.file&&a.file.name&&(a.title=d.capitaliseFirstLetter(d.getFileNameWithoutExtension(a.file.name)),a.fileName=d.slugify(a.title),c.focusById("title"))}function j(){m.command={}}function k(){l()}function l(){a.path("")}var m=this;g()}]),angular.module("cms.documents").controller("DocumentDetailsController",["$routeParams","$q","$location","_","shared.LoadState","shared.modalDialogService","shared.permissionValidationService","shared.urlLibrary","documents.documentService","documents.modulePath",function(a,b,c,d,e,f,g,h,i,j){function k(){v.edit=l,v.save=m,v.cancel=n,v.remove=o,v.editMode=!1,v.globalLoadState=new e,v.saveLoadState=new e,v.formLoadState=new e(!0),v.canUpdate=g.canUpdate("COFDOC"),v.canDelete=g.canDelete("COFDOC"),q(v.formLoadState)}function l(){v.editMode=!0,v.mainForm.formStatus.clear()}function m(){t(v.saveLoadState),i.update(v.command).progress(v.saveLoadState.setProgress).then(p.bind(null,"Changes were saved successfully",v.saveLoadState))["finally"](u.bind(null,v.saveLoadState))}function n(){v.editMode=!1,v.previewDocument=d.clone(v.document),v.command=r(v.document),v.previewUrl=h.getDocumentUrl(v.previewDocument),v.mainForm.formStatus.clear()}function o(){function a(){return t(),i.remove(v.document.documentAssetId).then(s)["catch"](u)}var b={title:"Delete Document",message:"Are you sure you want to delete this document?",okButtonTitle:"Yes, delete it",onOk:a};f.confirm(b)}function p(a,b){return q(b).then(v.mainForm.formStatus.success.bind(null,a))}function q(b){function c(){return i.getById(a.id).then(function(a){v.document=a,v.previewDocument=a,v.command=r(a),v.previewUrl=h.getDocumentUrl(a),v.editMode=!1})}return c().then(u.bind(null,b))}function r(a){return d.pick(a,"documentAssetId","title","fileName","description","tags")}function s(){c.path("")}function t(a){v.globalLoadState.on(),a&&d.isFunction(a.on)&&a.on()}function u(a){v.globalLoadState.off(),a&&d.isFunction(a.off)&&a.off()}var v=this;k()}]),angular.module("cms.documents").controller("DocumentListController",["_","shared.LoadState","shared.SearchQuery","shared.urlLibrary","shared.permissionValidationService","documents.documentService",function(a,b,c,d,e,f){function g(){k.gridLoadState=new b,k.query=new c({onChanged:i}),k.filter=k.query.getFilters(),k.toggleFilter=h,k.getDocumentUrl=d.getDocumentUrl,k.canCreate=e.canCreate("COFDOC"),k.canUpdate=e.canUpdate("COFDOC"),h(!1),j()}function h(b){k.isFilterVisible=a.isUndefined(b)?!k.isFilterVisible:b}function i(){h(!1),j()}function j(){return k.gridLoadState.on(),f.getAll(k.query.getParameters()).then(function(a){k.result=a,k.gridLoadState.off()})}var k=this;g()}]);
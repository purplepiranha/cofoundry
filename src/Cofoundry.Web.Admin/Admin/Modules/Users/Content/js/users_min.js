/*! Cofoundry 2020-06-22 */
angular.module("cms.users",["ngRoute","cms.shared"]).constant("_",window._).constant("users.modulePath","/Admin/Modules/Users/Js/"),angular.module("cms.users").config(["$routeProvider","shared.routingUtilities","users.modulePath",function(a,b,c){b.registerCrudRoutes(a,c,"User")}]),angular.module("cms.users").factory("users.roleService",["$http","shared.serviceBase","users.options",function(a,b,c){var d={},e=b+"roles";return d.getSelectionList=function(){return a.get(e,{params:{userAreaCode:c.userAreaCode,excludeAnonymous:!0}})},d}]),angular.module("cms.users").factory("users.userService",["$http","shared.serviceBase","users.options",function(a,b,c){function d(a){return g+"/"+a}function e(a){return a=a||{},a.userAreaCode=c.userAreaCode,a}var f={},g=b+"users";return f.getAll=function(b){return b=e(b),a.get(g,{params:b})},f.getById=function(b){return a.get(d(b))},f.add=function(b){return b=e(b),b.generatePassword=!0,a.post(g,b)},f.update=function(b){return a.patch(d(b.userId),b)},f.remove=function(b){return a["delete"](d(b))},f}]),angular.module("cms.users").controller("AddUserController",["$location","_","shared.stringUtilities","shared.LoadState","users.userService","users.roleService","users.options",function(a,b,c,d,e,f,g){function h(){l(),m(),n.globalLoadState=new d,n.editMode=!1,n.userArea=g,n.save=i,n.cancel=j}function i(){n.globalLoadState.on(),e.add(n.command).then(k)["finally"](n.globalLoadState.off)}function j(){k()}function k(){a.path("/")}function l(){function a(a){a&&(n.roles=a.items,1===a.items.length&&(n.command.roleId=a.items[0].roleId))}return f.getSelectionList().then(a)}function m(){n.command={}}var n=this;h()}]),angular.module("cms.users").controller("UserDetailsController",["$routeParams","$location","$q","shared.LoadState","shared.modalDialogService","shared.permissionValidationService","users.userService","users.roleService","users.modulePath","users.options",function(a,b,c,d,e,f,g,h,i,j){function k(){x.edit=l,x.save=m,x.cancel=n,x.deleteUser=o,x.editMode=!1,x.globalLoadState=new d,x.saveLoadState=new d,x.formLoadState=new d(!0),x.userArea=j;var a="COF"===j.userAreaCode?"COFUSR":"COFUSN";x.canUpdate=f.canUpdate(a),x.canDelete=f.canDelete(a),c.all([q(),r()]).then(s).then(w.bind(null,x.formLoadState))}function l(){x.editMode=!0,x.mainForm.formStatus.clear()}function m(){v(x.saveLoadState),g.update(x.command).then(p.bind(null,"Changes were saved successfully"))["finally"](w.bind(null,x.saveLoadState))}function n(){x.editMode=!1,x.command=t(),x.mainForm.formStatus.clear()}function o(){function a(){return v(),g.remove(x.user.userId).then(u)["catch"](w)}var b={title:"Delete User",message:"Are you sure you want to delete this user?",okButtonTitle:"Yes, delete it",onOk:a};e.confirm(b)}function p(a){return r().then(s).then(x.mainForm.formStatus.success.bind(null,a))}function q(){function a(a){a&&(x.roles=a.items)}return h.getSelectionList().then(a)}function r(){function b(a){x.user=a}var c=a.id;return g.getById(c).then(b)}function s(){x.command=t(),x.editMode=!1}function t(){var a=_.pick(x.user,"userId","firstName","lastName","username","email");return x.user.role&&(a.roleId=x.user.role.roleId),a}function u(){b.path("")}function v(a){x.globalLoadState.on(),a&&_.isFunction(a.on)&&a.on()}function w(a){x.globalLoadState.off(),a&&_.isFunction(a.off)&&a.off()}var x=this;k()}]),angular.module("cms.users").controller("UserListController",["_","shared.LoadState","shared.SearchQuery","shared.urlLibrary","shared.permissionValidationService","users.userService","users.options",function(a,b,c,d,e,f,g){function h(){l.userArea=g,l.urlLibrary=d,l.gridLoadState=new b,l.query=new c({onChanged:j}),l.filter=l.query.getFilters(),l.toggleFilter=i;var a="COF"===g.userAreaCode?"COFUSR":"COFUSN";l.canRead=e.canRead(a),l.canUpdate=e.canUpdate(a),l.canCreate=e.canCreate(a),i(!1),k()}function i(b){l.isFilterVisible=a.isUndefined(b)?!l.isFilterVisible:b}function j(){i(!1),k()}function k(){return l.gridLoadState.on(),f.getAll(l.query.getParameters()).then(function(a){l.result=a,l.gridLoadState.off()})}var l=this;h()}]);